# Issue #10: GPS EXIF 쓰기 기능 구현 Planning

---

## [공통] Workflow 규칙 안내
- 본 파일을 포함한 모든 workflow/rule 파일은 반드시 doc/rules/workflow_common.md(공통 규칙)을 준수해야 함

이 파일은 새로운 이슈(기능/개선/버그 등) 진행 시 일관된 설계·구현·테스트 계획을 수립하기 위한 템플릿과 체크리스트입니다.

---

## 0. 실제 이슈 내용 확인 (GitHub MCP/코딩 에이전트 활용)

- Issue #10: GPS EXIF 쓰기 기능을 구현하여, 수정된 GPS 정보를 사진 파일 자체에 저장
- 사용자 요청: "GPS 위치 수정 후 실제 파일에 저장하기 위한 EXIF 쓰기 기능 구현"
- 사전 작업: Issue #9에서 GPS 수정 UI와 히스토리는 완성, 파일 쓰기 기능만 미구현

---

## 1. 구현 범위 및 방향

1. **핵심 기능/요구사항**
   - 사진 파일의 GPS EXIF 메타데이터 수정 및 저장 기능
   - 플랫폼별 네이티브 EXIF 편집: Android(ExifInterface), iOS(ImageIO)
   - 저장 성공/실패 사용자 피드백 제공
   - 파일 권한 처리 및 안전한 파일 접근

2. **적용 범위**
   - MapScreen에서 GPS 수정 후 저장 버튼 활성화
   - 선택된 사진의 EXIF GPS 데이터를 실제 파일에 기록
   - 성공 시 알림 표시, 실패 시 오류 표시

3. **설정/미리보기/UX**
   - GPS 수정 UI에 "저장" 버튼 추가
   - 저장 진행 중 로딩 인디케이터 표시
   - 저장 성공/실패 토스트/다이얼로그 표시

4. **적용/변경 방식**
   - 플랫폼 채널(MethodChannel)을 통한 네이티브 EXIF 편집 호출
   - 비동기 처리로 UI 블로킹 방지
   - 파일 잠금 보장을 위한 안전한 파일 접근

5. **테스트 환경**
   - Android 우선 통합 테스트, 이후 iOS 확장
   - 읽기/쓰기 기능 조합 테스트
   - 권한 없는 환경에서의 Graceful Degradation

6. **기타**
   - 백업 기능 고려 (수정 전 파일 보존 옵션)
   - 메모리 효율적 구현 (대용량 사진 처리)
   - 보안 고려 (파일 경로 익포저 최소화)

---

## 2. 결론(요약)

- GPS 수정 결과를 사진 파일 EXIF에 저장하는 플랫폼별 네이티브 구현, 안전한 파일 처리 및 사용자 피드백 제공

---

## 3. Tasks (체크리스트)

- [ ] Android ExifInterface 네이티브 구현
- [ ] iOS ImageIO 네이티브 구현
- [ ] Flutter MethodChannel 인터페이스 강화
- [ ] MapScreen 저장 버튼 및 UI 추가
- [ ] 파일 권한 처리 (WRITE_EXTERNAL_STORAGE, photo access)
- [ ] 성공/실패 사용자 피드백 구현
- [ ] 단위 테스트 작성 (EXIF 쓰기 검증)
- [ ] 플랫폼별 통합 테스트
- [ ] 문서화 및 에러 처리

---

## 4. Inline Q&A (선택)

- Q: 저장 시점은? A: GPS 수정 버튼 클릭 이후 별도 저장 액션으로 분리
- Q: 백업 정책은? A: 옵셔널 백업 추천, 기본은 덮어쓰기 (실험적 기능)
- Q: 에러 처리 우선순위는? A: 권한 오류 > 파일 액세스 오류 > EXIF 형식 오류
